(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-15"),headers:{authorization:"0d4fb9d5-dd34-405c-82ac-856c24d548a6","Content-Type":"application/json"}},e=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o={method:r,headers:t.headers};return"GET"!=r&&n&&(o.body=JSON.stringify(n)),fetch("".concat(t.baseUrl,"/").concat(e),o).then((function(t){return t.ok?t.json():Promise.reject(t)}))},r=document.querySelector(".popup_edit-profile"),n=document.querySelector(".popup_add-elements"),o=document.querySelector(".popup_overview"),u=document.querySelector(".popup_edit-avatar"),c=document.querySelector(".form_edit-profile"),i=document.querySelector(".form__input_type_firstname"),a=document.querySelector(".form__input_type_profession"),l=document.querySelector(".form__input_type_town"),s=document.querySelector(".form__input_type_townlink"),d=document.querySelector(".form__input_type_avatar"),f=document.querySelector(".form_add-elements"),p=document.querySelector(".form_edit-avatar"),m=document.querySelector(".profile__title-firstname"),y=document.querySelector(".profile__subtitle-profession"),v=document.querySelector(".overview__image"),_=document.querySelector(".overview__caption"),b=u.querySelector("#avatar-input"),S=document.querySelector("#avatar"),h=document.querySelector(".profile__info-avatar"),q=document.querySelector(".button_type_save"),E=document.querySelector(".button_type_edit"),g=document.querySelector(".button_type_add"),C=(document.querySelector("template"),document.querySelector(".elements")),L=document.querySelector(".popup_error"),A=L.querySelector(".form__title"),k=document.querySelector("#submit-card"),O=document.querySelector("#submit-avatar"),w={formSelector:".popup__box",inputSelector:".form__input",submitButtonSelector:".button_type_save",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input-error",errorClass:"form__input-error_active"};function j(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function T(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var x={name:"",about:"",avatar:"",_id:"",cohort:""};function P(t){return x=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?j(Object(r),!0).forEach((function(e){T(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t),B(),x}function D(t){return t._id===x._id}function B(){m.textContent=x.name,y.textContent=x.about,S.setAttribute("src",x.avatar)}var I;function M(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(r.inactiveButtonClass),e.disabled=!1):(e.classList.add(r.inactiveButtonClass),e.disabled=!0)}function U(t,e){var r=t.querySelector(e.submitButtonSelector);r.classList.add(e.inactiveButtonClass),r.setAttribute("disabled","disabled")}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function H(t){t.classList.add("popup_opened"),document.addEventListener("keydown",V)}function N(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",V)}function V(t){"Escape"===t.key&&N(document.querySelector(".".concat("popup_opened")))}(function(t){if(Array.isArray(t))return G(t)}(I=document.querySelectorAll(".popup"))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(I)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?G(t,e):void 0}}(I)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(t){return t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&N(t)}))}));var $=function(t){A.textContent=t,H(L)};q.addEventListener("click",(function(){A.textContent="",N(L)}));var z=document.querySelector("#template__element"),J=function(t){var e=z.content.cloneNode(!0),r=e.querySelector(".elements__foto");r.setAttribute("src",t.link),r.setAttribute("alt",t.name),r.addEventListener("click",(function(t){return e=t.target,v.setAttribute("src",e.src),v.setAttribute("alt",e.alt),_.textContent=e.alt,void H(o);var e})),e.querySelector(".elements__title").textContent=t.name;var n=e.querySelector(".button_type_like");t.likes.some((function(t){return D(t)}))&&n.classList.add("button_type_like_on");var u=e.querySelector(".element__like-count");u.textContent=t.likes.length,n.addEventListener("click",(function(e){return K(t._id,e,u)}));var c=e.querySelector(".button_type_delete-element");if(D(t.owner)){var i=e.querySelector(".elements__element");c.addEventListener("click",(function(){return F(t._id,i)}))}else c.remove();return e},F=function(t,r){return function(t){return e("cards/".concat(t),"DELETE")}(t).then((function(){return Q(r)})).catch((function(t){return popupError(t)}))},K=function(t,r,n){var o=r.target,u=o.classList.contains("button_type_like_on")?function(t){return e("cards/likes/".concat(t),"DELETE")}(t):function(t){return e("cards/likes/".concat(t),"PUT")}(t);u.then((function(t){n.textContent=t.likes.length,o.classList.toggle("button_type_like_on")})).catch((function(t){return popupError(t)}))},Q=function(t){t.remove()};function R(t,e){t.textContent=e}function W(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}document.querySelectorAll(".button_type_close").forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return N(e)}))})),Promise.all([e("users/me"),e("cards")]).then((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,u=[],c=!0,i=!1;try{for(r=r.call(t);!(c=(n=r.next()).done)&&(u.push(n.value),!e||u.length!==e);c=!0);}catch(t){i=!0,o=t}finally{try{c||null==r.return||r.return()}finally{if(i)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return W(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?W(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),r=e[0],n=e[1];P(r),B(),n.forEach((function(t){return function(t){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?C.append(t):C.prepend(t)}(J(t),!1)}))})).catch((function(t){return $(t)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);M(r,n,e),r.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,r){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(t,e,r):function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,e,e.validationMessage,r)}(t,o,e),M(r,n,e)}))}))}(e,t)}))}(w),E.addEventListener("click",(function(){var t={name:m.textContent,about:y.textContent};i.value=t.name,a.value=t.about,H(r)})),c.addEventListener("submit",(function(t){t.preventDefault();var n=i.value,o=a.value;R(q,"Идет сохранение..."),function(t,r){return e("users/me","PATCH",{name:t,about:r})}(n,o).then((function(e){R(q,"Успешно"),setTimeout((function(){t.target.reset(),P(e),N(r)}),500)})).catch((function(t){return console.log(t)})).finally((function(){setTimeout((function(){return R(q,"Сохранить")}),500)}))})),g.addEventListener("click",(function(){return H(n),void U(n,w)})),f.addEventListener("submit",(function(t){t.preventDefault();var r,o,u=l.value,c=s.value;R(k,"Идет сохранение"),(r=u,o=c,e("cards/","POST",{name:r,link:o})).then((function(e){R(k,"Успешно"),setTimeout((function(){t.target.reset(),C.prepend(J(e)),N(n)}),500)})).catch((function(t){return $(t)})).finally((function(){setTimeout((function(){return R(k,"Сохранить")}),500)}))})),h.addEventListener("click",(function(){H(u),U(u,w)})),p.addEventListener("submit",(function(t){var r;t.preventDefault(),N(u),S.setAttribute("src",b.value),R(O,"Идет сохранение..."),(r=b.value,e("users/me/avatar","PATCH",{avatar:r})).then((function(e){R(O,"Успешно"),setTimeout((function(){t.target.reset(),P(e),S.setAttribute("src",e.avatar),d.value=""}),500)})).catch((function(t){return $(t)})).finally((function(){setTimeout((function(){return R(O,"Сохранить")}),500)}))}))})();